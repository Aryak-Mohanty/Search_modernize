<!DOCTYPE html>
<html lang="en" style="height:100%">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="icon.png" />
  <title>Search Website</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    /* 1. LAYOUT: Vertical Flex for the whole page */
    body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #f5efe7 0%, #e8dfd2 100%);
      display: flex;
      flex-direction: column;
      min-height: 0;
      font-family: 'Inter', sans-serif;
    }

    a.nav-link {
      color: #007b00;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    a.nav-link:hover {
      color: #005500;
    }

    /* 2. NAVBAR */
    nav.navbar {
      position: relative !important;
      flex: 0 0 auto;
      z-index: 1030;
      background: rgba(255, 255, 255, 0.9) !important;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
    }

    /* 3. CONTAINER */
    #container {
      display: flex;
      flex: 1;
      height: 100%;
      margin-top: 0;
      overflow: hidden;
      min-height: 0;
    }

    /* 4. SEARCH FRAME */
    #searchFrame {
      min-width: 200px;
      overflow: hidden;
      min-height: 250px;
      flex-shrink: 0;
      z-index: 1;
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    #searchFrame h1 {
      font-family: 'Inter', sans-serif;
      font-weight: 800;
      background: linear-gradient(45deg, #198754, #20c997);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1.5rem !important;
    }

    #searchInput {
      border-radius: 50px;
      padding: 12px 20px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    #searchInput:focus {
      box-shadow: 0 8px 25px rgba(25, 135, 84, 0.15);
      border-color: #198754;
      transform: translateY(-2px);
    }

    #searchButton {
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      padding: 10px 25px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    #searchButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(25, 135, 84, 0.3) !important;
    }

    #searchButton:active {
      transform: translateY(0);
    }

    /* 5. DIVIDER (Desktop Default) */
    #divider {
      flex: 0 0 6px;
      cursor: col-resize;
      background: #ddd;
      position: relative;
      z-index: 100;
      transition: background 0.2s;
    }

    #divider:hover {
      background: #ccc;
    }

    #divider::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 4px;
      height: 30px;
      background: #aaa;
      border-radius: 2px;
      transform: translate(-50%, -50%);
    }

    /* 6. RESULT FRAME */
    #resultFrame {
      overflow-y: auto;
      flex: 1;
      min-height: 150px;
      z-index: 0;
      padding: 2rem !important;
      transition: opacity 0.3s ease;
      opacity: 1;
    }

    /* Result Cards */
    .result-card {
      border: none;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02), 0 1px 3px rgba(0, 0, 0, 0.05);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      overflow: hidden;
    }

    .result-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 30px rgba(0, 0, 0, 0.08), 0 10px 10px rgba(0, 0, 0, 0.04);
      background: rgba(255, 255, 255, 0.95);
      z-index: 10;
    }

    .result-card h5 a {
      color: #198754;
      font-weight: 700;
      transition: color 0.2s;
    }

    .result-card h5 a:hover {
      color: #146c43;
      text-decoration: underline !important;
    }

    .result-card img {
      transition: transform 0.5s ease;
    }

    .result-card:hover img {
      transform: scale(1.1);
    }

    /* === ANIMATIONS === */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-up {
      animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      opacity: 0;
    }

    /* === DARK MODE STYLES === */
    body.dark-mode {
      background: #000000;
      color: #e0e0e0;
    }

    body.dark-mode a.nav-link {
      color: #8fe08b !important;
    }

    body.dark-mode a.nav-link:hover {
      color: #b0f2ac !important;
    }

    body.dark-mode #divider {
      background: #444;
    }

    body.dark-mode #divider:hover {
      background: #555;
    }

    body.dark-mode .result-card {
      background: rgba(20, 20, 20, 0.8) !important;
      color: #eee !important;
      box-shadow: 0 4px 6px rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    body.dark-mode .result-card:hover {
      background: rgba(30, 30, 30, 0.95) !important;
      box-shadow: 0 20px 30px rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.2);
    }

    body.dark-mode .result-card .text-muted {
      color: #aaa !important;
    }

    body.dark-mode nav.navbar {
      background: rgba(30, 30, 30, 0.8) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
    }

    body.dark-mode nav.navbar .nav-link {
      color: #8fe08b !important;
    }

    body.dark-mode #themeLabel {
      color: #8fe08b !important;
    }

    body.dark-mode #searchFrame {
      background: rgba(0, 0, 0, 0.2);
    }

    body.dark-mode #searchInput {
      background: #333;
      border-color: #444;
      color: #fff;
    }

    body.dark-mode #searchInput:focus {
      background: #3a3a3a;
      border-color: #8fe08b;
      box-shadow: 0 8px 25px rgba(143, 224, 139, 0.1);
    }

    /* Improved Placeholder Visibility */
    body.dark-mode #searchInput::placeholder {
      color: #aaa;
      opacity: 1;
    }

    /* === THEME TOGGLE === */
    #themeToggleBtn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      color: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease;
    }

    #themeToggleBtn:hover {
      transform: scale(1.1);
    }

    .icon-sun,
    .icon-moon {
      width: 24px;
      height: 24px;
      fill: currentColor;
      display: none;
    }

    body:not(.dark-mode) .icon-moon {
      display: block;
      fill: #555;
    }

    body.dark-mode .icon-sun {
      display: block;
      fill: #f1c40f;
    }

    /* === FLOATING SEARCH BUTTON === */
    #floatingSearchBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #198754;
      color: white;
      border: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);

      display: none;
      /* Hidden on desktop */
      align-items: center;
      justify-content: center;
      z-index: 2000;
      cursor: pointer;

      /* Animation: Start invisible */
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
      transform: scale(0);
      opacity: 0;
    }

    #floatingSearchBtn:active {
      transform: scale(0.9) !important;
    }

    #floatingSearchBtn svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    /* Class added by JS to show the button */
    #floatingSearchBtn.visible {
      transform: scale(1);
      opacity: 1;
    }

    /* === MOBILE FIXES === */
    @media(max-width:768px) {

      /* Restore page scrolling */
      html,
      body {
        height: auto !important;
        overflow-y: auto !important;
      }

      /* Enable button layout (visibility controlled by JS class) */
      #floatingSearchBtn {
        display: flex !important;
      }

      #container {
        flex-direction: column;
        height: auto !important;
        display: flex !important;
        overflow: visible !important;
      }

      #divider {
        display: none !important;
      }

      #searchFrame {
        /* FIX FOR GAP: Don't grow, just fit content */
        flex: 0 0 auto !important;
        width: 100% !important;
        min-height: auto !important;
        padding-bottom: 1.5rem !important;
        border-right: none !important;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.6);
        /* Slightly more opaque on mobile */
      }

      #resultFrame {
        /* Take remaining space */
        flex: 1 0 auto !important;
        height: auto !important;
        overflow: visible !important;
      }
    }
  </style>
</head>

<body id="pageBody" class="h-100">

  <nav class="navbar shadow-sm px-3 d-flex justify-content-between">
    <div class="d-flex align-items-center gap-5 gap-md-3 gap-lg-5">
      <a class="nav-link fw-bold" href="#">Home</a>
      <a class="nav-link fw-bold" href="https://aryak-mohanty.github.io/Projects/">List</a>
    </div>
    <div class="d-flex align-items-center gap-2">
      <span id="themeLabel" class="nav-link fw-bold" style="min-width: 40px; text-align: right;">Light</span>
      <button id="themeToggleBtn" class="nav-link" aria-label="Toggle Theme">
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 9c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />
        </svg>
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z" />
        </svg>
      </button>
    </div>
  </nav>

  <div id="container" class="d-flex">
    <div id="searchFrame" class="p-4 d-flex flex-column align-items-center justify-content-center border-end">
      <h1 class="mb-4">Search</h1>
      <input id="searchInput" class="form-control mb-3" style="max-width:300px" autocomplete="off"
        placeholder="Type to search...">
      <button id="searchButton" class="btn btn-success btn-lg d-flex align-items-center gap-2 rounded-pill shadow-sm">
        <img src="icons8-search-48.png" style="height:22px;width:22px; filter: brightness(0) invert(1);"> Search
      </button>
    </div>

    <div id="divider"></div>
    <div id="resultFrame" class="p-3 row g-4"></div>
  </div>

  <button id="floatingSearchBtn" aria-label="Back to Search">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path
        d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
    </svg>
  </button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* === Floating Search Button === */
    document.getElementById('floatingSearchBtn').onclick = () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.getElementById('searchInput').focus();
    };

    /* === Dark Mode (System Preference Enabled) === */
    const themeBtn = document.getElementById('themeToggleBtn');
    const themeLabel = document.getElementById('themeLabel');
    const colorSchemeQuery = window.matchMedia('(prefers-color-scheme: dark)');

    function applyTheme() {
      const dark = document.body.classList.contains('dark-mode');
      themeLabel.textContent = dark ? 'Dark' : 'Light';
    }

    function checkSystemTheme() {
      const systemPrefersDark = colorSchemeQuery.matches;
      const storedTheme = localStorage.getItem('theme');

      if (storedTheme === 'dark' || (storedTheme === null && systemPrefersDark)) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
      applyTheme();
    }

    checkSystemTheme();

    colorSchemeQuery.addEventListener('change', checkSystemTheme);

    themeBtn.onclick = () => {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
      applyTheme();
    };

    /* === Global Vars for Search === */
    let page = 1;
    let query = '';
    const apiKey = 'AIzaSyA2iJ5eI2Y_4wM04yOaX0fXpINMemQAnw0';
    const cx = '40f00a839f2504550';

    /* === Search Logic === */
    function search() {
      const q = document.getElementById('searchInput').value.trim();
      if (!q) return;

      query = q;
      page = 1;

      const box = document.getElementById('resultFrame');

      // 1. Fade out old results
      box.style.opacity = '0';

      // 2. Wait for fade out
      setTimeout(() => {
        // Use direct API call instead of local server
        fetch(`https://www.googleapis.com/customsearch/v1?key=${apiKey}&cx=${cx}&q=${encodeURIComponent(q)}`)
          .then(r => r.json())
          .then(d => {
            // 3. Reset scroll and prepare container
            box.scrollTop = 0;

            // Disable transition to instantly show container (so items can animate in)
            box.style.transition = 'none';
            box.style.opacity = '1';

            displayResults(d.items || []);

            // Re-enable transition for next time (after a small tick)
            requestAnimationFrame(() => {
              box.style.transition = 'opacity 0.3s ease';
            });
          })
          .catch(err => {
            console.error(err);
            displayResults([]);
            box.style.opacity = '1';
          });
      }, 300); // Match CSS transition duration
    }

    document.getElementById('searchButton').onclick = search;
    document.getElementById('searchInput').onkeydown = e => { if (e.key === 'Enter') search(); };

    /* === Display Results === */
    function displayResults(items, append = false) {
      const box = document.getElementById('resultFrame');
      if (!append) box.innerHTML = '';

      if (!items || items.length === 0) {
        if (!append) box.innerHTML = '<div class="col-12 text-center mt-5 animate-fade-up"><h3 class="text-muted">No results found.</h3><p class="text-muted">Try a different keyword.</p></div>';
        return;
      }

      items.forEach((r, index) => {
        const img = r?.pagemap?.cse_image?.[0]?.src || '';
        const delay = (index % 10) * 0.1;

        const html = `
        <div class="col-md-6 col-lg-4 animate-fade-up" style="animation-delay: ${delay}s">
          <div class="card result-card h-100">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title mb-3">
                  <a href="${r.link}" target="_blank" class="text-decoration-none text-break stretched-link">${r.title}</a>
                </h5>
                <div class="d-flex align-items-start gap-3">
                  ${img ? `<div class="rounded overflow-hidden flex-shrink-0" style="width:80px;height:80px;"><img src="${img}" class="w-100 h-100 object-fit-cover"></div>` : ''}
                  <p class="card-text text-muted small flex-grow-1 text-break mb-0" style="min-width: 0;">
                    ${r.snippet || ''}
                  </p>
                </div>
            </div>
          </div>
        </div>`;

        box.insertAdjacentHTML('beforeend', html);
      });
    }

    /* === Resizable Panels === */
    const container = document.getElementById('container');
    const left = document.getElementById('searchFrame');
    const right = document.getElementById('resultFrame');
    const divider = document.getElementById('divider');

    window.addEventListener('DOMContentLoaded', () => {
      if (window.innerWidth > 768) {
         left.style.flex = '0.3 1 0';
         right.style.flex = '0.7 1 0';
      }
    });

    let drag = false;

    // Desktop Resize
    divider.addEventListener('mousedown', e => { drag = true; document.body.style.userSelect = 'none'; });
    document.addEventListener('mouseup', () => { drag = false; document.body.style.userSelect = ''; });
    document.addEventListener('mousemove', e => {
      if (!drag) return;
      const rect = container.getBoundingClientRect();
      let ratio = (e.clientX - rect.left) / rect.width;
      ratio = Math.max(0.15, Math.min(0.85, ratio));
      left.style.flex = `${ratio} 1 0`;
      right.style.flex = `${1 - ratio} 1 0`;
    });

    /* === Infinite Scroll === */
    function loadMore() {
      if (!query) return;
      page++;

      // Use direct API call
      fetch(`https://www.googleapis.com/customsearch/v1?key=${apiKey}&cx=${cx}&q=${encodeURIComponent(query)}&start=${page * 10}`)
        .then(r => r.json())
        .then(d => {
          displayResults(d.items || [], true);
        })
        .catch(() => { });
    }

    const scrollTarget = window.innerWidth <= 768 ? window : document.getElementById('resultFrame');

    scrollTarget.addEventListener('scroll', function () {
      const isMobile = window.innerWidth <= 768;
      let scrollTop, clientHeight, scrollHeight;

      if (isMobile) {
        scrollTop = window.scrollY || document.documentElement.scrollTop || document.body.scrollTop;
        clientHeight = window.innerHeight;
        scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
      } else {
        scrollTop = this.scrollTop;
        clientHeight = this.clientHeight;
        scrollHeight = this.scrollHeight;
      }

      if (scrollTop + clientHeight >= scrollHeight - 100) {
        loadMore();
      }
    });

    /* === NEW: Watch for Search Box Visibility (Pop-up Button) === */
    const searchFrameObserver = new IntersectionObserver((entries) => {
      const btn = document.getElementById('floatingSearchBtn');
      // If searchFrame is NOT visible, show the button
      if (!entries[0].isIntersecting) {
        btn.classList.add('visible');
      } else {
        btn.classList.remove('visible');
      }
    }, {
      root: null,
      threshold: 0.1 // Trigger when < 10% of search box is visible
    });

    searchFrameObserver.observe(document.getElementById('searchFrame'));
  </script>

</body>

</html>